<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.autotrade.dao.SellCarDao">

	<!-- SQL片段查询所有 -->
	<sql id="find_All">
		id,buying_id,type,first_payment,monthly_supply,monthly_number,insurance,money,create_time,update_time,user
	</sql>


	<!-- 映射结果集 -->
	<resultMap type="com.autotrade.entity.SellCar" id="BaseResultMap">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="buying_id" jdbcType="BIGINT" property="buying_id" />
		<result column="type" jdbcType="INTEGER" property="type" />
		<result column="first_payment" jdbcType="DECIMAL" property="first_payment" />
		<result column="monthly_supply" jdbcType="DECIMAL" property="monthly_supply" />
		<result column="monthly_number" jdbcType="INTEGER" property="monthly_number" />
		<result column="insurance" jdbcType="INTEGER" property="insurance" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="create_time" jdbcType="DATE" property="create_time" />
		<result column="update_time" jdbcType="DATE" property="update_time" />
		<result column="types" jdbcType="INTEGER" property="types" />
	</resultMap>


	<!-- 分页查询售车信息 -->
	<!-- List<SellCar> findByLimit(@Param("page")Integer page, @Param("limit") 
		Integer limit); -->
	<!-- <select id="findByLimit" resultMap="BaseResultMap"> select t.*,u.* 
		from t_car_information t join t_user u on t.buying_id=u.id limit #{page},#{limit} 
		</select> -->

	<!-- 分页查询售车信息 -->
	<!-- List<SellCarVo> findByLimit(@Param("page") Integer page, @Param("limit") 
		Integer limit) -->
	<select id="findByLimit" resultType="com.autotrade.entityVo.SellCarVo">

		select
			b.name,b.phone,c.vehicle_type,c.first_payment,c.create_time,b.id,c.id
			as c_id,b.address
		from
			t_buying_customers b join t_car_information c on b.id=c.buying_id
		limit
			#{page},#{limit}
	</select>

	<!-- 查询售车信息总数量 -->
	<!-- Integer findAllCount(); -->
	<select id="findAllCount" resultType="java.lang.Integer">
		select
		count(id)
		from
		t_car_information
	</select>


	<!-- 通过售车订单Id查询订单信息以及此订单所属用户信息 -->
	<!-- ShowCarVo findById(Integer id); -->
	<select id="findById" resultType="com.autotrade.entityVo.ShowCarVo">
		select
		b.name,b.phone,b.address,c.type,c.first_payment,c.monthly_number,c.monthly_supply,c.insurance,b.id,c.id
		as c_id,c.money,c.vehicle_type
		from
		t_buying_customers b join t_car_information c on b.id=c.buying_id
		where
		c.id = #{id}
	</select>


	<!-- 修改售车订单，根据id -->
	<!-- Integer updateSellCar(SellCar sellCar) -->
	<update id="updateSellCar">
		update
		t_car_information
		<set>
			<if test="first_payment!=null">
				first_payment=#{first_payment},
			</if>
			<if test="monthly_number!=null">
				monthly_number=#{monthly_number},
			</if>
			<if test="monthly_supply!=null">
				monthly_supply=#{monthly_supply},
			</if>
			<if test="insurance!=null">
				insurance=#{insurance},
			</if>
			update_time=now()
		</set>
		where id=#{c_id}
	</update>

	<!-- 根据关键字分页查询 -->
	<!-- List<SellCarVo> findByKeyWord(@Param("keyWord")String keyWord,@Param("page")Integer 
		page,@Param("limit")Integer limit) -->
	<select id="findByKeyWord" resultType="com.autotrade.entityVo.SellCarVo">
		select
			b.name,b.phone,b.address,c.vehicle_type,c.first_payment,c.create_time,b.id,c.id
			as c_id
		from
			t_buying_customers b join t_car_information c on b.id=c.buying_id
		where
			b.name like #{keyWord} 
			or b.phone like #{keyWord} 
			or b.address like #{keyWord} 
			or c.vehicle_type like #{keyWord} 
			or c.first_payment like
			#{keyWord}
		limit
			#{page},#{limit}
	</select>

	
	
	<!-- 根据买车客户电话查询其信息 -->
	<!-- BuyingCustomer findClientByPhone(String phone) -->
	<select id="findClientByPhone" resultType="com.autotrade.entity.BuyingCustomer">
		select
			*
		from 
			t_buying_customers
		where
			phone = #{phone}
	</select>
	
	
	<!-- 根据用户所填购车信息增加售车订单表数据 -->
	<!-- Integer addSellCar(ShowCarVo showCarVo) -->
	<insert id="addSellCar" parameterType="com.autotrade.entityVo.ShowCarVo" useGeneratedKeys="true"
		keyProperty="id">
		insert into
			t_car_information(
					buying_id,
					type,
					first_payment,
					monthly_supply,
					monthly_number,
					insurance,
					money,
					<if test=" types !=null and types!=''">
					types,
					</if>
					update_time,
					vehicle_type,
					vehile_name,
					create_time
									
			)values(
					<if test=" id!=null and id!=''">
					#{id,jdbcType=BIGINT},
					</if>
					<if test=" type!=null and type!=''">
					#{type,jdbcType=INTEGER},
					</if>
					<if test=" first_payment!=null and first_payment!=''">
					#{first_payment,jdbcType=DECIMAL},
					</if>
					<if test=" monthly_supply!=null and monthly_supply!=''">
					#{monthly_supply,jdbcType=DECIMAL},
					</if>
					<if test=" monthly_number!=null and monthly_number!=''">
					#{monthly_number,jdbcType=INTEGER},
					</if>
					<if test=" insurance!=null and insurance !=''">
					#{insurance,jdbcType=INTEGER},
					</if>
					<if test=" money!=null and money !=''">
					#{money,jdbcType=DECIMAL},
					</if>
					<if test=" types!=null and types !='' ">
					#{types,jdbcType=INTEGER},
					</if>
					<if test=" update_time != null and update_time !=''">
					#{update_time,jdbcType=DATE},
					</if>
					<if test=" vehicle_type!=null and vehicle_type !=''">
					#{vehicle_type,jdbcType=VARCHAR},
					</if>
					<if test=" vehicle_type !=null and vehicle_type !=''">
					#{vehicle_type,jdbcType=VARCHAR},
					</if>
					<if test=" create_time!=null and create_time !=''">
					#{create_time,jdbcType=DATE}
					</if>
			)
			
		
	</insert>
	
	
	


</mapper>